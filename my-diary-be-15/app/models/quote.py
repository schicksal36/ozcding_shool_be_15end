# app/models/quote.py
from tortoise import fields, models
from app.models.bookmark import Bookmark


class Quote(models.Model):
    """
    ===============================================================
    QUOTES í…Œì´ë¸” ëª¨ë¸ (ëª…ì–¸ ë°ì´í„°)
    ---------------------------------------------------------------
    ì´ ëª¨ë¸ì€ ìŠ¤í¬ë˜í•‘ ê¸°ëŠ¥, ëª…ì–¸ ì¡°íšŒ API, ë¶ë§ˆí¬ ê¸°ëŠ¥ì˜
    í•µì‹¬ ì—”í‹°í‹°(ë°ì´í„° ë² ì´ìŠ¤ í…Œì´ë¸”)ì— í•´ë‹¹í•©ë‹ˆë‹¤.

    êµ¬ì„± ìš”ì†Œ:
      - content: ëª…ì–¸ ë³¸ë¬¸
      - author: ì‘ì„±ì(ì—†ì„ ìˆ˜ ìˆìŒ)
      - users_bookmarking: ì´ ëª…ì–¸ì„ ë¶ë§ˆí¬í•œ ì‚¬ìš©ìë“¤ì˜ ê´€ê³„ (ì—­ì°¸ì¡°)

    Quote(1) â† Bookmark(N) â†’ User(1)
    ---------------------------------------------------------------
    """

    # -----------------------------------------------------------
    # ğŸ”¹ Primary key
    # -----------------------------------------------------------
    id = fields.IntField(pk=True)
    """
    ìë™ ì¦ê°€ ì •ìˆ˜í˜• ê¸°ë³¸í‚¤
    PostgreSQLì—ì„œëŠ” SERIAL/IDENTITY í˜•íƒœë¡œ ìƒì„±ë¨.
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ëª…ì–¸ ë³¸ë¬¸ (TEXT)
    # -----------------------------------------------------------
    content = fields.TextField()
    """
    TEXT íƒ€ì…ìœ¼ë¡œ ê¸¸ì´ ì œí•œ ì—†ìŒ.
    ìŠ¤í¬ë˜í•‘ ê³¼ì •ì—ì„œ ë‹¤ì–‘í•œ ê¸¸ì´ì˜ ë¬¸ì¥ì´ ë“¤ì–´ì˜¤ë¯€ë¡œ TextFieldê°€ ì í•©.
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ì‘ì„±ì (nullable)
    # -----------------------------------------------------------
    author = fields.CharField(max_length=100, null=True)
    """
    ëŒ€ë¶€ë¶„ì˜ ëª…ì–¸ ì¶œì²˜ëŠ” ì œê³µë˜ì§€ë§Œ,
    ì¼ë¶€ëŠ” ì¶œì²˜ ë¯¸ìƒ(null)ì¼ ìˆ˜ ìˆìŒ.
    TextFieldë³´ë‹¤ CharFieldê°€ ì í•©í•œ ê¸¸ì´.
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ì—­ì°¸ì¡° ê´€ê³„ (ReverseRelation)
    # -----------------------------------------------------------
    users_bookmarking: fields.ReverseRelation["Bookmark"]
    """
    â­ ReverseRelation ì„¤ëª… (ì¤‘ìš”):

    Bookmark ëª¨ë¸ì—ëŠ” ë‹¤ìŒ FKê°€ ì¡´ì¬í•œë‹¤ê³  ê°€ì •:

        user = fields.ForeignKeyField("models.User", related_name="bookmarks")
        quote = fields.ForeignKeyField("models.Quote", related_name="users_bookmarking")

    ì¦‰,
        Bookmark.quote_id â†’ Quote.id (N â†’ 1 ê´€ê³„)

    ReverseRelationì€ ê·¸ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ìë™ ìƒì„±ë˜ëŠ” ê´€ê³„ì…ë‹ˆë‹¤.

    Quote ëª¨ë¸ì—ì„œ ì•„ë˜ì²˜ëŸ¼ ì ‘ê·¼ ê°€ëŠ¥:

        quote = await Quote.get(id=1)
        bookmarks = await quote.users_bookmarking.all()

    ì—¬ê¸°ì„œ bookmarkëŠ” "ì´ ëª…ì–¸ì„ ë¶ë§ˆí¬í•œ ë¡œê·¸"ë“¤ì…ë‹ˆë‹¤.
    (ë¶ë§ˆí¬í•œ User ê°ì²´ê°€ ë°”ë¡œ ë‚˜ì˜¤ì§€ ì•Šê³  Bookmark ê°ì²´ê°€ ë‚˜ì˜´)

    DB ì»¬ëŸ¼ì€ ìƒì„±ë˜ì§€ ì•Šê³ , ORM ë ˆë²¨ì—ì„œë§Œ ì¡´ì¬í•©ë‹ˆë‹¤.
    """

