# app/models/quote.py

from tortoise import fields, models
from app.models.bookmark import Bookmark


class Quote(models.Model):
    """
    ===============================================================
    ğŸ”¥ Quote ëª¨ë¸ (ëª…ì–¸ ë°ì´í„°)
    ---------------------------------------------------------------
    QUOTES í…Œì´ë¸”ì„ ë‚˜íƒ€ë‚´ë©°,
    - content: ëª…ì–¸ ë³¸ë¬¸
    - author: ì‘ì„±ì
    - Bookmark ëª¨ë¸ê³¼ 1:N ê´€ê³„ (í•œ ëª…ì–¸ì´ ì—¬ëŸ¬ ì‚¬ìš©ìì—ê²Œ ë¶ë§ˆí¬ë  ìˆ˜ ìˆìŒ)

    ERD êµ¬ì¡°:
        USER ||--o{ BOOKMARK }o--|| QUOTE 
        (Userì™€ Quote ì‚¬ì´ì˜ ë‹¤ëŒ€ë‹¤(N:N)ë¥¼ BOOKMARK í…Œì´ë¸”ë¡œ êµ¬í˜„)

        User   1----N   Bookmark   N----1   Quote
    ===============================================================
    """

    # -----------------------------------------------------------
    # ğŸ”¹ Primary Key
    # -----------------------------------------------------------
    id = fields.IntField(pk=True)
    """
    ìë™ ì¦ê°€ ì •ìˆ˜í˜• ê¸°ë³¸í‚¤
    â†’ PostgreSQLì—ì„œëŠ” SERIAL / IDENTITY ì»¬ëŸ¼
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ëª…ì–¸ ë‚´ìš©
    # -----------------------------------------------------------
    content = fields.TextField()
    """
    ëª…ì–¸ ë³¸ë¬¸(TEXT)
    - ê¸¸ì´ ì œí•œ ì—†ìŒ
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ì‘ì„±ì(ì˜µì…˜)
    # -----------------------------------------------------------
    author = fields.CharField(max_length=100, null=True)
    """
    ì‘ì„±ì ë˜ëŠ” ì¶œì²˜
    null í—ˆìš© â†’ ì‘ê°€ ë¯¸ìƒ ëª…ì–¸ë„ ì €ì¥ ê°€ëŠ¥
    """

    # -----------------------------------------------------------
    # ğŸ”¹ ReverseRelation â€” ì—­ì°¸ì¡° ê´€ê³„ (ì¤‘ìš”!)
    # -----------------------------------------------------------
    users_bookmarking: fields.ReverseRelation["Bookmark"]
    """
    ReverseRelation ì„¤ëª…:

    Bookmark ëª¨ë¸ì—ëŠ” ë‹¤ìŒ í•„ë“œê°€ ì¡´ì¬í•œë‹¤ê³  ê°€ì •:
        quote = fields.ForeignKeyField("models.Quote", related_name="users_bookmarking")

    â†’ ì¦‰, Bookmark.quote_id â†’ Quote.id (N:1 ê´€ê³„)

    ReverseRelationì€ ORMì´ ìë™ìœ¼ë¡œ ë§Œë“œëŠ” ë°˜ëŒ€ ë°©í–¥ ì°¸ì¡°ë¡œ,
    Quote ëª¨ë¸ì—ì„œ ìì‹ ì„ ë¶ë§ˆí¬í•œ Bookmark ëª©ë¡ì— ì ‘ê·¼ ê°€ëŠ¥:

        quote = await Quote.get(id=1)
        bookmarks = await quote.users_bookmarking.all()
        # â†’ ì´ ëª…ì–¸ì„ ë¶ë§ˆí¬í•œ ëª¨ë“  Bookmark ê°ì²´ ì¡°íšŒ ê°€ëŠ¥

    ì£¼ì˜:
    - ReverseRelationì€ DBì—ì„œ ì»¬ëŸ¼ì´ ìƒê¸°ì§€ ì•ŠìŒ (ORM ë‚´ë¶€ ê¸°ëŠ¥)
    - ë°˜ë“œì‹œ íƒ€ì… íŒíŠ¸ë¡œë§Œ ì„ ì–¸í•´ì•¼ í•˜ë©° í• ë‹¹ ì—°ì‚° X
    """
